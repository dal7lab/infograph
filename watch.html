<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BERKLEY WIDE VIEW</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jura:wght@300;500;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-family: 'Jura', sans-serif;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: radial-gradient(circle at 50% 50%, #111 0%, #000 100%);
        }

        /* --- TOP NAVIGATION (Horizontal, Minimal) --- */
        #top-nav {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            overflow-x: auto;
            white-space: nowrap;
            backdrop-filter: blur(5px);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: #666;
            font-family: 'Jura', sans-serif;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }

        .nav-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-btn.active {
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
        }

        /* --- BOTTOM INFO (Minimal Overlay) --- */
        #bottom-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            backdrop-filter: blur(5px);
            pointer-events: none; /* Click through allowed */
            opacity: 0;
            transition: opacity 0.5s;
        }

        #bottom-info.visible {
            opacity: 1;
        }

        .info-title {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
            letter-spacing: 2px;
        }

        .info-desc {
            color: #ccc;
            font-size: 12px;
            line-height: 1.4;
        }

        /* --- SCROLLBAR HIDE --- */
        #top-nav::-webkit-scrollbar { height: 2px; }
        #top-nav::-webkit-scrollbar-thumb { background: #444; }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <!-- Top Navigation -->
    <nav id="top-nav">
        <!-- Buttons injected by JS -->
    </nav>

    <!-- Bottom Info Overlay -->
    <div id="bottom-info">
        <div class="info-title" id="info-title">MODULE NAME</div>
        <div class="info-desc" id="info-desc">Description text...</div>
    </div>

    <script>
        // --- DATA DEFINITION ---
        const modules = {
            'all': { title: 'FULL ASSEMBLY', desc: '2,877개 부품의 전체 결합 상태. 마우스로 드래그하여 회전, 휠로 줌인/아웃 하세요.', y: 0 },
            'core': { title: 'CORE CHASSIS', desc: 'Caliber 3752의 베이스 플레이트. 양면 다이얼 구동을 위한 리버싱 기어 시스템.', y: 0 },
            'chinese': { title: 'CHINESE CALENDAR', desc: '불규칙한 음력 윤달/설날을 계산하는 비정형 캠(Cam) 알고리즘.', y: 8 },
            'tourbillon': { title: '3-AXIS TOURBILLON', desc: '중력 오차를 상쇄하는 3축 회전 구체형 투르비용.', y: 16 },
            'sky': { title: 'CELESTIAL CHART', desc: '사용자 위치 기반의 실시간 밤하늘 성도(Star Chart).', y: 24 },
            'chime': { title: 'WESTMINSTER CHIME', desc: '5개의 공과 해머로 연주하는 시각 알림(Sonnerie).', y: -8 },
            'retro': { title: 'RETROGRADE DATE', desc: '순식간에 원점으로 복귀하는 날짜 표시 메커니즘.', y: -16 },
            'split': { title: 'SPLIT-CHRONO', desc: '두 개의 시간을 동시에 계측하는 스플릿 세컨드 시스템.', y: -24 },
            'eq': { title: 'EQUATION OF TIME', desc: '태양시와 평균시의 차이를 보여주는 콩팥 모양(Kidney) 캠.', y: 32 },
            'moon': { title: 'PRECISION MOON', desc: '1027년에 하루 오차를 갖는 초정밀 문페이즈 구체.', y: 40 }
        };

        // --- THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.015);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(60, 20, 60);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ReinhardToneMapping;
        container.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 1.5);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffd700, 1.2);
        dirLight.position.set(50, 50, 50);
        scene.add(dirLight);
        const blueLight = new THREE.PointLight(0x00ffff, 0.8, 100);
        blueLight.position.set(-30, 0, -30);
        scene.add(blueLight);

        // --- PROCEDURAL OBJECTS ---
        const matGold = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8, roughness: 0.3 });
        const matSteel = new THREE.MeshStandardMaterial({ color: 0xaaccff, metalness: 0.9, roughness: 0.2 });
        const matWire = new THREE.LineBasicMaterial({ color: 0x444444, transparent: true, opacity: 0.3 });

        const masterGroup = new THREE.Group();
        scene.add(masterGroup);

        // Helper: Gear
        function makeGear(r, teeth, color) {
            const g = new THREE.Group();
            const geo = new THREE.CylinderGeometry(r, r, 0.5, teeth * 2);
            const mesh = new THREE.Mesh(geo, color);
            g.add(mesh);
            // Wireframe for tech look
            const edges = new THREE.LineSegments(new THREE.EdgesGeometry(geo), matWire);
            g.add(edges);
            return g;
        }

        const objects = {};

        // 1. CORE
        objects['core'] = makeGear(12, 32, matSteel);
        objects['core'].position.y = modules['core'].y;
        masterGroup.add(objects['core']);

        // 2. CHINESE (Irregular Cam)
        const camShape = new THREE.Shape();
        for(let i=0; i<60; i++) {
            let a = (i/60)*Math.PI*2;
            let rad = 6 + Math.sin(a*3) + Math.cos(a*5);
            camShape.lineTo(Math.cos(a)*rad, Math.sin(a)*rad);
        }
        objects['chinese'] = new THREE.Mesh(new THREE.ExtrudeGeometry(camShape, {depth:1, bevelEnabled:false}), matGold);
        objects['chinese'].rotation.x = Math.PI/2;
        objects['chinese'].position.y = modules['chinese'].y;
        masterGroup.add(objects['chinese']);

        // 3. TOURBILLON (Spheres)
        const tGroup = new THREE.Group();
        tGroup.add(new THREE.Mesh(new THREE.SphereGeometry(4, 16, 16), new THREE.MeshBasicMaterial({color:0xffd700, wireframe:true})));
        tGroup.add(new THREE.Mesh(new THREE.SphereGeometry(2.5, 16, 16), new THREE.MeshBasicMaterial({color:0x00ffff, wireframe:true})));
        objects['tourbillon'] = tGroup;
        objects['tourbillon'].position.y = modules['tourbillon'].y;
        masterGroup.add(tGroup);

        // 4. SKY (Points)
        const starGeo = new THREE.BufferGeometry();
        const stars = [];
        for(let i=0; i<500; i++) stars.push((Math.random()-0.5)*30, (Math.random()-0.5)*2, (Math.random()-0.5)*30);
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(stars, 3));
        objects['sky'] = new THREE.Points(starGeo, new THREE.PointsMaterial({color:0xffffff, size:0.2}));
        objects['sky'].position.y = modules['sky'].y;
        masterGroup.add(objects['sky']);

        // 5. CHIME (Torus)
        const cGroup = new THREE.Group();
        for(let i=0; i<3; i++) {
            let ring = new THREE.Mesh(new THREE.TorusGeometry(8+i*2, 0.2, 8, 50), matSteel);
            ring.rotation.x = Math.PI/2;
            cGroup.add(ring);
        }
        objects['chime'] = cGroup;
        objects['chime'].position.y = modules['chime'].y;
        masterGroup.add(cGroup);

        // 6. RETRO (Arc)
        objects['retro'] = new THREE.Mesh(new THREE.TorusGeometry(8, 0.5, 8, 50, Math.PI), matGold);
        objects['retro'].rotation.x = Math.PI/2;
        objects['retro'].position.y = modules['retro'].y;
        masterGroup.add(objects['retro']);

        // 7. SPLIT (Dual Gears)
        const sGroup = new THREE.Group();
        sGroup.add(makeGear(4, 20, matSteel));
        let g2 = makeGear(4, 20, matGold);
        g2.position.y = 1;
        sGroup.add(g2);
        objects['split'] = sGroup;
        objects['split'].position.y = modules['split'].y;
        masterGroup.add(sGroup);

        // 8. EQ (Kidney)
        objects['eq'] = new THREE.Mesh(new THREE.TorusKnotGeometry(3, 0.5, 64, 8), matGold);
        objects['eq'].position.y = modules['eq'].y;
        masterGroup.add(objects['eq']);

        // 9. MOON
        objects['moon'] = new THREE.Mesh(new THREE.SphereGeometry(4, 32, 32), new THREE.MeshStandardMaterial({color:0xeeeeee, roughness:0.8}));
        objects['moon'].position.y = modules['moon'].y;
        masterGroup.add(objects['moon']);

        // SPINE
        const spine = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 90, 8), matWire);
        masterGroup.add(spine);


        // --- INTERACTION LOGIC ---
        const nav = document.getElementById('top-nav');
        const infoBox = document.getElementById('bottom-info');
        const infoTitle = document.getElementById('info-title');
        const infoDesc = document.getElementById('info-desc');

        // Build Menu
        Object.keys(modules).forEach(key => {
            const btn = document.createElement('button');
            btn.className = 'nav-btn';
            btn.innerText = key.toUpperCase();
            btn.onclick = () => selectModule(key, btn);
            nav.appendChild(btn);
        });

        let currentTargetY = 0;

        function selectModule(key, btn) {
            // Update UI
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Show Info
            infoTitle.innerText = modules[key].title;
            infoDesc.innerText = modules[key].desc;
            infoBox.classList.add('visible');

            // Camera Move
            if(key === 'all') {
                new TWEEN.Tween(camera.position).to({x: 60, y: 10, z: 60}, 1000).easing(TWEEN.Easing.Quadratic.Out).start();
                new TWEEN.Tween(controls).to({y: 0}, 1000).start();
                // Reset Opacity
                Object.values(objects).forEach(o => {
                    o.traverse(c => { if(c.material) c.material.opacity = 1; c.material.transparent = false; });
                });
            } else {
                const targetY = modules[key].y;
                new TWEEN.Tween(camera.position).to({x: 30, y: targetY + 5, z: 30}, 1000).easing(TWEEN.Easing.Quadratic.Out).start();
                new TWEEN.Tween(controls).to({y: targetY}, 1000).start();
                
                // Focus Effect (Dim others)
                Object.keys(objects).forEach(k => {
                    const obj = objects[k];
                    const isTarget = (k === key);
                    obj.traverse(c => {
                        if(c.material) {
                            c.material.transparent = true;
                            c.material.opacity = isTarget ? 1 : 0.1;
                        }
                    });
                });
            }
        }

        // Default Select
        selectModule('all', document.querySelector('.nav-btn'));


        // --- RENDER LOOP ---
        let controls = { y: 0 }; // LookAt target Y
        let isDragging = false;
        let prevMouse = { x: 0, y: 0 };

        document.addEventListener('mousedown', (e) => { if(e.target.tagName !== 'BUTTON') isDragging = true; });
        document.addEventListener('mouseup', () => isDragging = false);
        document.addEventListener('mousemove', (e) => {
            if(isDragging) {
                const dx = e.clientX - prevMouse.x;
                const dy = e.clientY - prevMouse.y;
                masterGroup.rotation.y += dx * 0.005;
                masterGroup.rotation.x += dy * 0.005;
            }
            prevMouse = { x: e.clientX, y: e.clientY };
        });
        document.addEventListener('wheel', (e) => {
            camera.zoom -= e.deltaY * 0.001;
            camera.zoom = Math.max(0.5, Math.min(3, camera.zoom));
            camera.updateProjectionMatrix();
        });

        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);

            // Constant Rotation
            if(!isDragging) masterGroup.rotation.y += 0.002;

            // Individual Anim
            objects['tourbillon'].rotation.x += 0.05;
            objects['tourbillon'].rotation.y += 0.02;
            objects['chinese'].rotation.z -= 0.01;
            objects['sky'].rotation.y += 0.001;

            camera.lookAt(0, controls.y, 0);
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>

